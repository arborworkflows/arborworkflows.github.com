<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Add packages to Arbor • Arbor</title>
    
    
    
    	<!-- Twitter Cards -->
	<meta name="twitter:title" content="Add packages to Arbor">
	
	<meta name="twitter:site" content="@lukejharmon">
	<meta name="twitter:creator" content="@lukejharmon">
	
	<meta name="twitter:card" content="summary">
	<meta name="twitter:image" content="/images/120x120.gif">
	
	<!-- Open Graph -->
	<meta property="og:locale" content="en_US">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Add packages to Arbor">
	
	<meta property="og:url" content="/build/addPackage.html">
	<meta property="og:site_name" content="Arbor">

    <link rel="canonical" href="/build/addPackage.html">

    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Arbor Atom Feed">
    <link href="/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cleartype" content="on">

    <link rel="stylesheet" href="/css/main.css">
    <!-- HTML5 Shiv and Media Query Support for IE -->
    <!--[if lt IE 9]>
      <script src="/js/vendor/html5shiv.min.js"></script>
      <script src="/js/vendor/respond.min.js"></script>
    <![endif]-->

  </head>

  <body id="js-body">
    <!--[if lt IE 9]><div class="upgrade notice-warning"><strong>Your browser is quite old!</strong> Why not <a href="http://whatbrowser.org/">upgrade to a newer one</a> to better enjoy this site?</div><![endif]-->

    <header id="masthead">
  <div class="inner-wrap">
    <a href="/" class="site-title">Arbor</a>
    <nav role="navigation" class="menu top-menu">
        <ul class="menu-item">
	<li class="home"><a href="/">Arbor</a></li>
	
    
    <li><a href="/help/" >Help</a></li>
  
    
    <li><a href="/usearbor/" >Use Arbor</a></li>
  
    
    <li><a href="/documentation/" >Docs & tutorials</a></li>
  
    
    <li><a href="/build/" >Developers</a></li>
  
    
    <li><a href="/team/" >Contact</a></li>
  
</ul>

    </nav>
  </div><!-- /.inner-wrap -->
</header><!-- /.masthead -->

    <nav role="navigation" id="js-menu" class="sliding-menu-content">
  <h5>Arbor <span>Table of Contents</span></h5>
  <ul class="menu-item">
    <li>
      <a href="/help/">
        <img src="/images/400x250.gif" alt="teaser" class="teaser">
        <div class="title">Help</div>
        <p class="excerpt">Get help</p>
      </a>
    </li><li>
      <a href="/usearbor/">
        <img src="/images/400x250.gif" alt="teaser" class="teaser">
        <div class="title">Use Arbor</div>
        <p class="excerpt">Run Arbor over the web or install it yourself</p>
      </a>
    </li><li>
      <a href="/documentation/">
        <img src="/images/400x250.gif" alt="teaser" class="teaser">
        <div class="title">Docs & tutorials</div>
        <p class="excerpt">Full documentation for functions and workflows</p>
      </a>
    </li><li>
      <a href="/build/">
        <img src="/images/400x250.gif" alt="teaser" class="teaser">
        <div class="title">Developers</div>
        <p class="excerpt">Add to the Arbor code base</p>
      </a>
    </li><li>
      <a href="/team/">
        <img src="/images/400x250.gif" alt="teaser" class="teaser">
        <div class="title">Contact</div>
        <p class="excerpt">Contact us</p>
      </a>
    </li>
  </ul>
</nav>
<button type="button" id="js-menu-trigger" class="sliding-menu-button lines-button x2" role="button" aria-label="Toggle Navigation">
  <span class="nav-lines"></span>
</button>

<div id="js-menu-screen" class="menu-screen"></div>


    <div id="page-wrapper">
      <div class="post">
  <header class="post-header">
    <h1 class="h2">Add packages to Arbor</h1>
  </header>
  <article class="post-content">
  <p>Adding new R packages or python libraries to Arbor is not difficult, but the method you use depends on the type of Arbor instance you are using.</p>

<h2 id="new-packages-on-arbor-aws-instances">New packages on Arbor AWS instances</h2>

<p>If you are using one of our <a href="/usearbor/aws-instances/">AWS instances</a>, then the only way to add new R packages is to <a href="/team/">contact us</a>. We can get things installed for you quickly and easily, but it requires administrative access to the instance.</p>

<h2 id="new-packages-on-locally-installed-aws-instances">New packages on locally installed AWS instances</h2>

<h3 id="local-installation-using-ssh">Local installation using ssh</h3>

<p>If you have an Arbor instance on a local machine, you have two options. First, you can ssh into the instance and install the R package.</p>

<p>To get into the vagrant machine use:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vagrant ssh
</code></pre></div></div>

<p>You should see something like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Lukes-MacBook-Pro:flow lukeharmon$ vagrant ssh
Welcome to Ubuntu 14.04.5 LTS (GNU/Linux 3.13.0-117-generic x86_64)

 * Documentation:  https://help.ubuntu.com/

  System information as of Wed May 31 20:12:04 UTC 2017

  System load:  0.0               Processes:           95
  Usage of /:   9.1% of 39.34GB   Users logged in:     0
  Memory usage: 10%               IP address for eth0: 10.0.2.15
  Swap usage:   0%

  Graph this data and manage this system at:
    https://landscape.canonical.com/

  Get cloud support with Ubuntu Advantage Cloud Guest:
    http://www.ubuntu.com/business/services/cloud

28 packages can be updated.
16 updates are security updates.

New release '16.04.2 LTS' available.
Run 'do-release-upgrade' to upgrade to it.


Last login: Wed May 31 20:12:05 2017 from 10.0.2.2
vagrant@vagrant-ubuntu-trusty-64:~$
</code></pre></div></div>

<p>Now start R. You will need administrative privileges, so:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo R
</code></pre></div></div>

<p>This starts an R environment.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vagrant@vagrant-ubuntu-trusty-64:~$ sudo R

R version 3.4.0 (2017-04-21) -- "You Stupid Darkness"
Copyright (C) 2017 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

&gt;
</code></pre></div></div>

<p>Now I can install any package I want. For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>install.packages("ouch")
</code></pre></div></div>

<p>You should get something like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; install.packages("ouch")
Installing package into ‘/usr/local/lib/R/site-library’
(as ‘lib’ is unspecified)
trying URL 'https://cran.cnr.berkeley.edu/src/contrib/ouch_2.9-2.tar.gz'
Content type 'application/x-gzip' length 37358 bytes (36 KB)
==================================================
downloaded 36 KB

* installing *source* package ‘ouch’ ...
** package ‘ouch’ successfully unpacked and MD5 sums checked
** libs
gcc -std=gnu99 -I/usr/share/R/include -DNDEBUG      -fpic  -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g  -c covar-matrix.c -o covar-matrix.o
gcc -std=gnu99 -I/usr/share/R/include -DNDEBUG      -fpic  -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2 -g  -c weight-matrix.c -o weight-matrix.o
gcc -std=gnu99 -shared -L/usr/lib/R/lib -Wl,-Bsymbolic-functions -Wl,-z,relro -o ouch.so covar-matrix.o weight-matrix.o -L/usr/lib/R/lib -lR
installing to /usr/local/lib/R/site-library/ouch/libs
** R
** data
** inst
** preparing package for lazy loading
** help
*** installing help indices
** building package indices
** testing if installed package can be loaded
* DONE (ouch)

The downloaded source packages are in
	‘/tmp/RtmpCawCDV/downloaded_packages’
&gt;
</code></pre></div></div>

<p>Now you can use this package in your Arbor functions!</p>

<p>If you use this method, then the packages will be installed on that virtual machine for as long as it lasts. However, if you destroy or reprovision that machine, then the packages will have to be reinstalled. For something more permanent, try the next method.</p>

<h3 id="adding-new-packages-to-the-virtual-machine">Adding new packages to the virtual machine</h3>

<p>You can determine which R packages are installed on an Arbor instance using Vagrant and ansible.</p>

<p>When you launch a new Arbor instance, one step involves cloning the <a href="https://github.com/kitware/flow">github repository that holds Kitware’s “flow” software</a>.</p>

<p>In your local clone of that repository, find the file ./devops/ansible/roles/arbor/tasks/main.yml. The Kitware default version is <a href="https://github.com/Kitware/flow/blob/master/devops/ansible/roles/arbor/tasks/main.yml">here</a>.</p>

<p>R packages to be installed are listed starting on line 42 of that file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
- name: install packages
  command: /usr/bin/Rscript --slave --no-save --no-restore-history -e "if (! ('' %in% installed.packages()[,'Package'])) install.packages(pkgs='', repos=c('http://cran.cnr.Berkeley.edu'))"
  become: yes
  with_items:
    - rgl
    - ape
    - geiger
    - nlme
    - codetools
    - devtools
    - diversitree
    - phytools
    - dplyr
  environment:
    DISPLAY: :7


- name: install github packages
  command: /usr/bin/Rscript --slave --no-save --no-restore-history -e "parts&lt;-unlist(strsplit('', '/'));options(repos='http://cran.cnr.Berkeley.edu');library(devtools);install_github(parts[2], parts[1])"
  become: yes
  with_items:
    - hafen/cardoonTools
    - tangelo-hub/romanescoTools
    - arborworkflows/aRbor
  environment:
</code></pre></div></div>

<p>New packages can be added to that list and will be installed when the machine is provisioned.</p>

<p>So, add ouch:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- name: install packages
  command: /usr/bin/Rscript --slave --no-save --no-restore-history -e "if (! ('' %in% installed.packages()[,'Package'])) install.packages(pkgs='', repos=c('http://cran.cnr.Berkeley.edu'))"
  become: yes
  with_items:
    - rgl
    - ape
    - geiger
    - nlme
    - codetools
    - devtools
    - diversitree
    - phytools
    - dplyr
    - ouch
  environment:
    DISPLAY: :7
</code></pre></div></div>

<p>And reprovision:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; vagrant provision
</code></pre></div></div>

  </article>
</div>

      <footer role="contentinfo" id="site-footer">
	<nav role="navigation" class="menu bottom-menu">
		<ul class="menu-item">
		
      
			<li><a href="/" >Home</a></li>
		
      
			<li><a href="/getting-started/" >Getting Started</a></li>
		
      
			<li><a href="/about/" >About</a></li>
		
      
			<li><a href="/team/" >Team</a></li>
		
		</ul>
	</nav><!-- /.bottom-menu -->
	<p class="copyright">&#169; 2018 <a href="/">Arbor</a> powered by <a href="http://jekyllrb.com">Jekyll</a> + <a href="http://mmistakes.github.io/skinny-bones-jekyll/">Skinny Bones</a>.</p>
</footer>

    </div>

    <script src="/js/vendor/jquery-1.9.1.min.js"></script>
    <script src="/js/main.js"></script>

  </body>
</html>
