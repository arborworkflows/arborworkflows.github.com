<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Create a new Arbor app. â€¢ Arbor</title>
    
    
    
    	<!-- Twitter Cards -->
	<meta name="twitter:title" content="Create a new Arbor app.">
	
	<meta name="twitter:site" content="@lukejharmon">
	<meta name="twitter:creator" content="@lukejharmon">
	
	<meta name="twitter:card" content="summary">
	<meta name="twitter:image" content="/images/120x120.gif">
	
	<!-- Open Graph -->
	<meta property="og:locale" content="en_US">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Create a new Arbor app.">
	
	<meta property="og:url" content="/build/addApp_fulljscode.html">
	<meta property="og:site_name" content="Arbor">

    <link rel="canonical" href="/build/addApp_fulljscode.html">

    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Arbor Atom Feed">
    <link href="/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cleartype" content="on">

    <link rel="stylesheet" href="/css/main.css">
    <!-- HTML5 Shiv and Media Query Support for IE -->
    <!--[if lt IE 9]>
      <script src="/js/vendor/html5shiv.min.js"></script>
      <script src="/js/vendor/respond.min.js"></script>
    <![endif]-->

  </head>

  <body id="js-body">
    <!--[if lt IE 9]><div class="upgrade notice-warning"><strong>Your browser is quite old!</strong> Why not <a href="http://whatbrowser.org/">upgrade to a newer one</a> to better enjoy this site?</div><![endif]-->

    <header id="masthead">
  <div class="inner-wrap">
    <a href="/" class="site-title">Arbor</a>
    <nav role="navigation" class="menu top-menu">
        <ul class="menu-item">
	<li class="home"><a href="/">Arbor</a></li>
	
    
    <li><a href="/help/" >Help</a></li>
  
    
    <li><a href="/usearbor/" >Use Arbor</a></li>
  
    
    <li><a href="/documentation/" >Docs & tutorials</a></li>
  
    
    <li><a href="/build/" >Developers</a></li>
  
    
    <li><a href="/team/" >Contact</a></li>
  
</ul>

    </nav>
  </div><!-- /.inner-wrap -->
</header><!-- /.masthead -->

    <nav role="navigation" id="js-menu" class="sliding-menu-content">
  <h5>Arbor <span>Table of Contents</span></h5>
  <ul class="menu-item">
    <li>
      <a href="/help/">
        <img src="/images/400x250.gif" alt="teaser" class="teaser">
        <div class="title">Help</div>
        <p class="excerpt">Get help</p>
      </a>
    </li><li>
      <a href="/usearbor/">
        <img src="/images/400x250.gif" alt="teaser" class="teaser">
        <div class="title">Use Arbor</div>
        <p class="excerpt">Run Arbor over the web or install it yourself</p>
      </a>
    </li><li>
      <a href="/documentation/">
        <img src="/images/400x250.gif" alt="teaser" class="teaser">
        <div class="title">Docs & tutorials</div>
        <p class="excerpt">Full documentation for functions and workflows</p>
      </a>
    </li><li>
      <a href="/build/">
        <img src="/images/400x250.gif" alt="teaser" class="teaser">
        <div class="title">Developers</div>
        <p class="excerpt">Add to the Arbor code base</p>
      </a>
    </li><li>
      <a href="/team/">
        <img src="/images/400x250.gif" alt="teaser" class="teaser">
        <div class="title">Contact</div>
        <p class="excerpt">Contact us</p>
      </a>
    </li>
  </ul>
</nav>
<button type="button" id="js-menu-trigger" class="sliding-menu-button lines-button x2" role="button" aria-label="Toggle Navigation">
  <span class="nav-lines"></span>
</button>

<div id="js-menu-screen" class="menu-screen"></div>


    <div id="page-wrapper">
      <div class="post">
  <header class="post-header">
    <h1 class="h2">Create a new Arbor app.</h1>
  </header>
  <article class="post-content">
  <p>Full javascript code (js/main.js) for simmap app. <a href="/build/addApp/">back to directions</a></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="cm">/*jslint browser: true, nomen: true */</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">flow</span><span class="p">,</span> <span class="nx">$</span><span class="p">,</span> <span class="nx">girder</span><span class="p">)</span> <span class="p">{</span>
    <span class="s1">'use strict'</span><span class="p">;</span>

    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">girder</span><span class="p">.</span><span class="nx">apiRoot</span> <span class="o">=</span> <span class="s1">'/girder/api/v1'</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">App</span><span class="p">({</span>
            <span class="na">el</span><span class="p">:</span> <span class="s1">'body'</span>
        <span class="p">});</span>

        <span class="c1">// Lookup the ID of the analysis that we wish to perform.</span>
        <span class="nx">app</span><span class="p">.</span><span class="nx">analysisName</span> <span class="o">=</span> <span class="s2">"makeSimmap-app"</span><span class="p">;</span>
        <span class="nx">girder</span><span class="p">.</span><span class="nx">restRequest</span><span class="p">({</span>
            <span class="na">path</span><span class="p">:</span> <span class="s1">'resource/search'</span><span class="p">,</span>
            <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">q</span><span class="p">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">analysisName</span><span class="p">,</span>
                <span class="na">types</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">([</span><span class="s2">"item"</span><span class="p">])</span>
            <span class="p">}</span>
        <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">analysisId</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="s2">"item"</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="nx">_id</span><span class="p">;</span>
            <span class="nx">app</span><span class="p">.</span><span class="nx">readyToAnalyze</span><span class="p">();</span>
        <span class="p">});</span>

        <span class="nx">app</span><span class="p">.</span><span class="nx">readyToAnalyze</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="s2">"column"</span> <span class="k">in</span> <span class="k">this</span> <span class="o">&amp;&amp;</span> <span class="s2">"table"</span> <span class="k">in</span> <span class="k">this</span> <span class="o">&amp;&amp;</span> <span class="s2">"tree"</span> <span class="k">in</span> <span class="k">this</span> <span class="o">&amp;&amp;</span>
                <span class="s2">"analysisId"</span> <span class="k">in</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#analyze"</span><span class="p">).</span><span class="nx">classed</span><span class="p">(</span><span class="s1">'disabled'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="kd">function</span> <span class="nx">toggleInputTablePreview</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">"#table-preview-icon"</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">"glyphicon-folder-close"</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">"#table-preview-icon"</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"glyphicon-folder-close"</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">"#table-preview-icon"</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"glyphicon-folder-open"</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">"#table-preview-text"</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">" Hide input table preview"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">"#table-preview-icon"</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"glyphicon-folder-open"</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">"#table-preview-icon"</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"glyphicon-folder-close"</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">"#table-preview-text"</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">" Show input table preview"</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">$</span><span class="p">(</span><span class="s2">"#input-table-vis"</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="s1">'slow'</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// override upload function for simple mode</span>
        <span class="nx">flow</span><span class="p">.</span><span class="nx">DatasetManagementView</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">upload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileReader</span><span class="p">();</span>

            <span class="nx">reader</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">dataset</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="na">name</span><span class="p">:</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
                        <span class="na">data</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span>
                    <span class="p">},</span>
                    <span class="nx">extension</span> <span class="o">=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">),</span>
                    <span class="nx">typeFormat</span><span class="p">;</span>

                <span class="nx">extension</span> <span class="o">=</span> <span class="nx">extension</span><span class="p">[</span><span class="nx">extension</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
                <span class="nx">typeFormat</span> <span class="o">=</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">getTypeFormatsFromExtension</span><span class="p">(</span><span class="nx">extension</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
                <span class="nx">typeFormat</span> <span class="o">=</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nx">typeFormat</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="na">format</span><span class="p">:</span> <span class="nx">typeFormat</span><span class="p">.</span><span class="nx">format</span><span class="p">};</span>
                <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">typeFormat</span><span class="p">);</span>
                <span class="nx">dataset</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="nx">dataset</span><span class="p">);</span>

                <span class="c1">// modifications for simple app begin here</span>
                <span class="c1">// if its a table, get the column names</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">typeFormat</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">"table"</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">app</span><span class="p">.</span><span class="nx">table</span> <span class="o">=</span> <span class="nx">dataset</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'data'</span><span class="p">);</span>
                    <span class="nx">app</span><span class="p">.</span><span class="nx">tableFormat</span> <span class="o">=</span> <span class="nx">typeFormat</span><span class="p">.</span><span class="nx">format</span><span class="p">;</span>
                    <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#table-name"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'Table: '</span> <span class="o">+</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">' &lt;span class="glyphicon glyphicon-ok-circle"&gt;&lt;/span&gt;'</span><span class="p">);</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s2">"#column-input"</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">"Parsing column names..."</span><span class="p">);</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s2">"#column-names"</span><span class="p">).</span><span class="nx">empty</span><span class="p">();</span>
                    <span class="nx">flow</span><span class="p">.</span><span class="nx">retrieveDatasetAsFormat</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="s2">"table"</span><span class="p">,</span> <span class="s2">"column.names"</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">dataset</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">columnNames</span> <span class="o">=</span> <span class="nx">dataset</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'data'</span><span class="p">);</span>
                        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">columnNames</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                            <span class="c1">// create drag-and-drop elements here</span>
                            <span class="nx">$</span><span class="p">(</span><span class="s2">"#column-names"</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">'&lt;div class="btn btn-info draggable"&gt;'</span> <span class="o">+</span> <span class="nx">columnNames</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'&lt;/div&gt;'</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s2">".draggable"</span><span class="p">).</span><span class="nx">draggable</span><span class="p">({</span>
                             <span class="na">zIndex</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">helper</span><span class="p">:</span> <span class="s2">"clone"</span>
                        <span class="p">});</span>
                        <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#column-input"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'Drag column of interest here &lt;span class="glyphicon glyphicon-exclamation-sign"&gt;&lt;/span&gt;'</span><span class="p">);</span>
                    <span class="p">},</span> <span class="k">this</span><span class="p">));</span>

                    <span class="nx">flow</span><span class="p">.</span><span class="nx">retrieveDatasetAsFormat</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="s2">"table"</span><span class="p">,</span> <span class="s2">"rows"</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">dataset</span><span class="p">)</span> <span class="p">{</span>
                      <span class="c1">// show the input table to help the user understand if their data</span>
                      <span class="c1">// was parsed correctly or not</span>
                      <span class="kd">var</span> <span class="nx">rowData</span> <span class="o">=</span> <span class="nx">dataset</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'data'</span><span class="p">);</span>
                      <span class="nx">rowData</span><span class="p">.</span><span class="nx">rows</span> <span class="o">=</span> <span class="nx">rowData</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
                      <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#input-table-vis-container"</span><span class="p">).</span><span class="nx">classed</span><span class="p">(</span><span class="s1">'hidden'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
                      <span class="nx">$</span><span class="p">(</span><span class="s2">"#input-table-vis"</span><span class="p">).</span><span class="nx">table</span><span class="p">({</span> <span class="na">data</span><span class="p">:</span> <span class="nx">rowData</span> <span class="p">});</span>
                      <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#column-input"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'Drag variable to analyze here &lt;span class="glyphicon glyphicon-exclamation-sign"&gt;&lt;/span&gt;'</span><span class="p">);</span>
                    <span class="p">},</span> <span class="k">this</span><span class="p">));</span>

                <span class="p">}</span>

                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">typeFormat</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">"tree"</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">app</span><span class="p">.</span><span class="nx">tree</span> <span class="o">=</span> <span class="nx">dataset</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'data'</span><span class="p">);</span>
                    <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#tree-name"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'Tree: '</span> <span class="o">+</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">' &lt;span class="glyphicon glyphicon-ok-circle"&gt;&lt;/span&gt;'</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">app</span><span class="p">.</span><span class="nx">readyToAnalyze</span><span class="p">();</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">datasets</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s1">'add'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">'set-collection'</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">dataset</span><span class="p">);</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">);</span>

            <span class="nx">reader</span><span class="p">.</span><span class="nx">readAsText</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
        <span class="p">};</span>

        <span class="nx">$</span><span class="p">(</span><span class="s2">"#column-input"</span><span class="p">).</span><span class="nx">droppable</span><span class="p">({</span>
            <span class="na">drop</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span> <span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">COI</span> <span class="o">=</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">draggable</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
                <span class="nx">app</span><span class="p">.</span><span class="nx">column</span> <span class="o">=</span> <span class="nx">COI</span><span class="p">;</span>
                <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#column-input"</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">classed</span><span class="p">(</span><span class="s1">'btn-primary'</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">classed</span><span class="p">(</span><span class="s1">'btn-success'</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">classed</span><span class="p">(</span><span class="s1">'bg-warning'</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">COI</span> <span class="o">+</span> <span class="s1">' &lt;span class="glyphicon glyphicon-ok-circle"&gt;&lt;/span&gt;'</span> <span class="o">+</span> <span class="s2">" (Y) ~"</span><span class="p">);</span>
                <span class="nx">app</span><span class="p">.</span><span class="nx">readyToAnalyze</span><span class="p">();</span>
            <span class="p">},</span>
            <span class="na">over</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#column-input"</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">classed</span><span class="p">(</span><span class="s1">'btn-success'</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">classed</span><span class="p">(</span><span class="s1">'bg-warning'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="na">out</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#column-input"</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">classed</span><span class="p">(</span><span class="s1">'btn-success'</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">classed</span><span class="p">(</span><span class="s1">'bg-warning'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="p">});</span>


        <span class="nx">$</span><span class="p">(</span><span class="s2">"#analyze"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">"#analyze"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"disabled"</span><span class="p">,</span> <span class="s2">"disabled"</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">"#analyze"</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">"Re-run"</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">"#notice"</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">"Performing analysis..."</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">inputs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="na">table</span><span class="p">:</span>  <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s2">"table"</span><span class="p">,</span>  <span class="na">format</span><span class="p">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">tableFormat</span><span class="p">,</span>    <span class="na">data</span><span class="p">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">table</span><span class="p">},</span>
                <span class="na">tree</span><span class="p">:</span>   <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s2">"tree"</span><span class="p">,</span>   <span class="na">format</span><span class="p">:</span> <span class="s2">"newick"</span><span class="p">,</span>           <span class="na">data</span><span class="p">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">tree</span><span class="p">},</span>
                <span class="na">variable</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span> <span class="na">format</span><span class="p">:</span> <span class="s2">"text"</span><span class="p">,</span>             <span class="na">data</span><span class="p">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">column</span><span class="p">}</span>
            <span class="p">};</span>

            <span class="kd">var</span> <span class="nx">outputs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="na">simmapPlot</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s2">"image"</span><span class="p">,</span> <span class="na">format</span><span class="p">:</span> <span class="s2">"png.base64"</span><span class="p">},</span>
            <span class="p">};</span>

            <span class="nx">flow</span><span class="p">.</span><span class="nx">performAnalysis</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">analysisId</span><span class="p">,</span> <span class="nx">inputs</span><span class="p">,</span> <span class="nx">outputs</span><span class="p">,</span>
                <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">app</span><span class="p">.</span><span class="nx">taskId</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">_id</span><span class="p">;</span>
                    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">checkResult</span><span class="p">,</span> <span class="nx">app</span><span class="p">),</span> <span class="mi">1000</span><span class="p">);</span>
                <span class="p">},</span> <span class="nx">app</span><span class="p">));</span>

        <span class="nx">app</span><span class="p">.</span><span class="nx">checkResult</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">check_url</span> <span class="o">=</span> <span class="s1">'/item/'</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">analysisId</span> <span class="o">+</span> <span class="s1">'/flow/'</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">taskId</span> <span class="o">+</span> <span class="s1">'/status'</span>
            <span class="nx">girder</span><span class="p">.</span><span class="nx">restRequest</span><span class="p">({</span><span class="na">path</span><span class="p">:</span> <span class="nx">check_url</span><span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="s1">'SUCCESS'</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// get result data</span>
                    <span class="kd">var</span> <span class="nx">result_url</span> <span class="o">=</span> <span class="s1">'/item/'</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">ASRId</span> <span class="o">+</span> <span class="s1">'/flow/'</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">taskId</span> <span class="o">+</span> <span class="s1">'/result'</span>
                    <span class="nx">girder</span><span class="p">.</span><span class="nx">restRequest</span><span class="p">({</span><span class="na">path</span><span class="p">:</span> <span class="nx">result_url</span><span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">app</span><span class="p">.</span><span class="nx">modelPlot</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">simmapPlot</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
                      <span class="c1">// render tree plot</span>
                      <span class="nx">$</span><span class="p">(</span><span class="s2">"#model-plot"</span><span class="p">).</span><span class="nx">image</span><span class="p">({</span> <span class="na">data</span><span class="p">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">modelPlot</span> <span class="p">});</span>
                      <span class="nx">$</span><span class="p">(</span><span class="s2">"#analyze"</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">"disabled"</span><span class="p">);</span>
                      <span class="nx">$</span><span class="p">(</span><span class="s2">"#notice"</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">"Analysis succeeded!"</span><span class="p">);</span>
                      <span class="nx">$</span><span class="p">(</span><span class="s1">'html, body'</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span>
                          <span class="na">scrollTop</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#model-plot"</span><span class="p">).</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span>
                      <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>




                  <span class="p">},</span> <span class="k">this</span><span class="p">));</span>

                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="s1">'FAILURE'</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s2">"#analyze"</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">"disabled"</span><span class="p">);</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s2">"#notice"</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">"Analysis failed. "</span> <span class="o">+</span> <span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">checkResult</span><span class="p">,</span> <span class="k">this</span><span class="p">),</span> <span class="mi">1000</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
        <span class="p">};</span>

        <span class="p">});</span>

        <span class="nx">$</span><span class="p">(</span><span class="s2">"#help"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">"#upload"</span><span class="p">).</span><span class="nx">popover</span><span class="p">({</span>
                <span class="na">title</span><span class="p">:</span> <span class="s1">'Step #1'</span><span class="p">,</span>
                <span class="na">content</span><span class="p">:</span> <span class="s1">'Upload your table (csv or tsv) and tree (newick) here'</span><span class="p">,</span>
                <span class="na">placement</span><span class="p">:</span> <span class="s1">'bottom'</span><span class="p">,</span>
                <span class="na">trigger</span><span class="p">:</span> <span class="s1">'manual'</span>
            <span class="p">});</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">"#upload"</span><span class="p">).</span><span class="nx">popover</span><span class="p">(</span><span class="s1">'toggle'</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">"#column-input"</span><span class="p">).</span><span class="nx">popover</span><span class="p">({</span>
                <span class="na">title</span><span class="p">:</span> <span class="s1">'Step #2'</span><span class="p">,</span>
                <span class="na">content</span><span class="p">:</span> <span class="s1">'Drag your column of interest here'</span><span class="p">,</span>
                <span class="na">placement</span><span class="p">:</span> <span class="s1">'left'</span><span class="p">,</span>
                <span class="na">trigger</span><span class="p">:</span> <span class="s1">'manual'</span>
            <span class="p">});</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">"#column-input"</span><span class="p">).</span><span class="nx">popover</span><span class="p">(</span><span class="s1">'toggle'</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">"#analyze"</span><span class="p">).</span><span class="nx">popover</span><span class="p">({</span>
                <span class="na">title</span><span class="p">:</span> <span class="s1">'Step #3'</span><span class="p">,</span>
                <span class="na">content</span><span class="p">:</span> <span class="s1">'Click on the "Go!" button'</span><span class="p">,</span>
                <span class="na">placement</span><span class="p">:</span> <span class="s1">'bottom'</span><span class="p">,</span>
                <span class="na">trigger</span><span class="p">:</span> <span class="s1">'manual'</span>
            <span class="p">});</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">"#analyze"</span><span class="p">).</span><span class="nx">popover</span><span class="p">(</span><span class="s1">'toggle'</span><span class="p">);</span>

        <span class="p">});</span>

        <span class="nx">$</span><span class="p">(</span><span class="s2">"#table-preview"</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">toggleInputTablePreview</span><span class="p">();</span>
        <span class="p">});</span>

        <span class="nx">app</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">flow</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">$</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">girder</span><span class="p">));</span>

</code></pre>
</div>

  </article>
</div>

      <footer role="contentinfo" id="site-footer">
	<nav role="navigation" class="menu bottom-menu">
		<ul class="menu-item">
		
      
			<li><a href="/" >Home</a></li>
		
      
			<li><a href="/getting-started/" >Getting Started</a></li>
		
      
			<li><a href="/about/" >About</a></li>
		
      
			<li><a href="/team/" >Team</a></li>
		
		</ul>
	</nav><!-- /.bottom-menu -->
	<p class="copyright">&#169; 2017 <a href="/">Arbor</a> powered by <a href="http://jekyllrb.com">Jekyll</a> + <a href="http://mmistakes.github.io/skinny-bones-jekyll/">Skinny Bones</a>.</p>
</footer>

    </div>

    <script src="/js/vendor/jquery-1.9.1.min.js"></script>
    <script src="/js/main.js"></script>

  </body>
</html>
